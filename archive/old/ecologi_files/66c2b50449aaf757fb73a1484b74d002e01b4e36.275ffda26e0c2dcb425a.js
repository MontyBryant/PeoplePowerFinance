(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[27],{"6CzD":function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r("YZeP");var a=r("TJjZ");function c(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(a.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},"6g8U":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return o}));var n=r("NthX"),a=r.n(n),c=r("eijD"),u=e.env.ROOT_WP_JSON_URL;function o(){return s.apply(this,arguments)}function s(){return(s=Object(c.a)(a.a.mark((function e(){var t,r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(u,"project?per_page=100"));case 2:return t=e.sent,e.next=5,t.json();case 5:return r=e.sent,n=r||[],e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,r("5IsQ"))},iDaA:function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return i}));var n,a=r("NthX"),c=r.n(a),u=r("eijD"),o=r("zLiM"),s=function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.a)("/leaderboards");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();!function(e){e.Members="members-trees",e.Business="business-trees",e.Referral="sparkly-trees"}(n||(n={}));var i=function(){var e=Object(u.a)(c.a.mark((function e(t,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.a)("/leaderboards/".concat(r));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},kJeB:function(e,t,r){"use strict";r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return p})),r.d(t,"b",(function(){return l}));var n=r("mK0O"),a=r("174k");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){var r=(t&&t.trees?t.trees:[]).reduce((function(e,t){return e+t.totalTrees}),0);return{numberOfTonnes:e.totalNumberOfTonnesOffset(),numberOfTrees:e.totalNumberOfTrees()+r,totalReferralTrees:r}}var s=function(e){return e.map((function(e){var t,r,n;return u(u({},e),{},{imageURL:null===(t=e.acf)||void 0===t||null===(r=t.images[0])||void 0===r?void 0:r.sizes.medium_large,description:null===(n=e.acf)||void 0===n?void 0:n.sell,title:e.title.rendered})}))},i=["https://offset-earth-share-images.s3-eu-west-1.amazonaws.com/og-bg-1.jpg","https://offset-earth-share-images.s3-eu-west-1.amazonaws.com/og-bg-2.jpg","https://offset-earth-share-images.s3-eu-west-1.amazonaws.com/og-bg-3.jpg","https://offset-earth-share-images.s3-eu-west-1.amazonaws.com/og-bg-4.jpg","https://offset-earth-share-images.s3-eu-west-1.amazonaws.com/og-bg-5.jpg"],f=function(e){return Math.floor(Math.random()*Math.floor(e))};function p(e,t){var r=o(e,t),n=r.numberOfTonnes,c=r.numberOfTrees;return{profileSocialImage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=encodeURIComponent(i[f(i.length)]),n=encodeURIComponent(e.profileImage),c=encodeURIComponent(Object(a.putCommasIntoNumber)(e.totalNumberOfTrees()+t));return"https://ogi.sh/ChE-uiVy9?logo=".concat(n,"&trees=").concat(c,"&bg=").concat(r)}(e,r.totalReferralTrees),socialTitle:e.fullName(),socialDescription:n>0?"View ".concat(e.fullNamePlural," Ecologi profile. So far they've offset ").concat(n," tonnes of CO2 and planted ").concat(c," trees!"):"View ".concat(e.fullNamePlural," Ecologi profile. So far they've planted ").concat(c," trees!")}}var l=function(e){return e.isUserType?e:new a.User(e)}},poRl:function(e,t,r){"use strict";r.d(t,"b",(function(){return D})),r.d(t,"a",(function(){return _})),r.d(t,"i",(function(){return M})),r.d(t,"g",(function(){return R})),r.d(t,"h",(function(){return z})),r.d(t,"d",(function(){return J})),r.d(t,"e",(function(){return A})),r.d(t,"j",(function(){return Q})),r.d(t,"f",(function(){return B})),r.d(t,"c",(function(){return L}));var n=r("6CzD"),a=r("dV/x"),c=r("aNYv"),u=r("NthX"),o=r.n(u),s=r("mK0O"),i=r("eijD"),f=r("mXGw"),p=r("2KSd"),l=r("B5kz"),b=r("iJDw"),d=r("dAGg"),O=r("ZLCB"),m=r.n(O),h=r("174k"),j=r("WYo3"),v=r("zLiM"),w=function(){var e=Object(i.a)(o.a.mark((function e(t,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(v.a)("/users/".concat(r,"/profile"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),y=r("6g8U"),g=function(){var e=Object(i.a)(o.a.mark((function e(t,r,n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.toLowerCase(),e.next=3,Object(v.a)("/users/".concat(r,"/referral-data-").concat(a));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),k=r("iDaA"),x=r("hl5C"),I=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(v.a)("/donations/one-time",{method:"POST",body:JSON.stringify(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(v.a)("/donations/session",{method:"POST",body:JSON.stringify(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=r("3Nqn"),T=r("AGGY"),U=r("kJeB");function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){Object(s.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var E="profile",D=function(){var e=Object(i.a)(o.a.mark((function e(t){var r,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new l.QueryCache,n={},e.next=4,r.prefetchQuery([E,t.params.usernameOrId],w);case 4:return e.abrupt("return",N({dehydratedState:Object(b.dehydrate)(r)},n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(i.a)(o.a.mark((function e(t){var r,n,a,u,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([D(t),Object(y.a)()]);case 2:return r=e.sent,n=Object(c.a)(r,2),a=n[0],u=n[1],s=Object(U.a)(u),e.abrupt("return",N(N({},a),{},{projects:s,layoutProps:{isProfile:!0}}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(e){return Object(l.useQuery)(["referral",e.userId,e.referralImpactIncluded],g,{enabled:!!e.referralImpactIncluded})},R=function(){return Object(l.useQuery)("leaderboards",k.b)},z=function(e){var t=Object(d.useRouter)(),r=Object(j.c)(),n=r.user,a=r.isCheckingUserSession,c=n&&[n.userId,n.username].includes(e),u={onError:function(e){x.a.isNotFoundError(e)&&!c&&t.push("/404")}},s=Object(l.useQuery)([E,e],w,u),f=Object(l.useQuery)(["get-store-user-as-result",c,a],function(){var e=Object(i.a)(o.a.mark((function e(t,r,a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a||!r){e.next=2;break}return e.abrupt("return",n);case 2:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),u);return c?f:s},J=function(){var e=Object(j.c)(),t=e.user,r=e.setUser,n=Object(d.useRouter)(),a=Object(l.useMutation)(I,{onSuccess:function(e,t){r(new h.User(e));var a=0===t.numberOfTrees?{carbonOnly:!0}:{};n.replace({pathname:"/[usernameOrId]",query:N({usernameOrId:e.username,success:!0},a)},void 0,{shallow:!0})},onError:function(e){p.c.error(Object(C.a)(e))}}),u=Object(c.a)(a,1)[0];return Object(f.useCallback)(Object(i.a)(o.a.mark((function e(){var r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return p.c.error("No user found, please refresh the page."),e.abrupt("return");case 3:if(t.isBillingEnabled){e.next=6;break}return p.c.error("No saved card details found"),e.abrupt("return");case 6:return e.next=8,u.apply(void 0,r);case 8:case"end":return e.stop()}}),e)}))),[u,t])},A=function(){var e=Object(j.c)().stripe,t=Object(l.useMutation)(P,{onSuccess:function(){var t=Object(i.a)(o.a.mark((function t(r){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.redirectToCheckout({sessionId:r.id});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onError:function(e){p.c.error(Object(C.a)(e))}}),r=Object(c.a)(t,1)[0];return Object(f.useCallback)(function(){var e=Object(i.a)(o.a.mark((function e(t){var n,c,u,s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.location.origin+window.location.pathname,c="".concat(n,"?success=true"),0===t.numberOfTrees&&(c+="&carbonOnly=true"),u=t.totalCost,s=t.campaign,i=Object(a.a)(t,["totalCost","campaign"]),e.next=6,r(N(N({},i),{},{cost:u,successUrl:c,errorUrl:"".concat(n,"?error=true"),isIntrepid:s===h.campaigns.intrepid.id}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r])},Q=function(){var e=Object(j.c)(),t=e.setUser,r=e.user,n=Object(l.useMutation)(T.h,{onMutate:function(){m.a.start(),p.c.info("Upload started, please wait...")},onSuccess:function(){var e=Object(i.a)(o.a.mark((function e(r){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.user,t(new h.User(n)),m.a.done(),p.c.success("Profile image updated");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onError:function(e){m.a.done(),p.c.error(Object(C.a)(e))}}),a=Object(c.a)(n,1)[0];return Object(f.useCallback)(function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a({userId:r.userId,file:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[a,r])},B=function(){var e=Object(j.c)().setUser,t=Object(l.useMutation)(T.g,{onSuccess:function(t){var r=t.user;e(new h.User(r))},onError:function(e){p.c.error(Object(C.a)(e))}});return Object(c.a)(t,1)[0]},L=function(){var e=Object(j.c)().setUser,t=Object(l.useMutation)(T.g,{onSuccess:function(t){var r=t.user;e(new h.User(r))},onError:function(e){p.c.error(Object(C.a)(e))}}),r=Object(c.a)(t,1)[0];return Object(f.useMemo)((function(){return{handleAddChecklistItem:function(){var e=Object(i.a)(o.a.mark((function e(t,a,c){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.a.start(),e.next=3,r({userId:t.userId,fieldsToUpdate:{checklistItems:[].concat(Object(n.a)(t.checklistItems),[{_id:a.value,text:a.label,isComplete:!1}])}});case 3:c(),m.a.done();case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),handleRemoveChecklistItem:function(){var e=Object(i.a)(o.a.mark((function e(t,a){var c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.checklistItems.findIndex((function(e){return e._id===a._id})),(u=Object(n.a)(t.checklistItems)).splice(c,1),m.a.start(),e.next=6,r({userId:t.userId,fieldsToUpdate:{checklistItems:u}});case 6:m.a.done();case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),handleToggleChecklistItem:function(){var e=Object(i.a)(o.a.mark((function e(t,a){var c,u,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.checklistItems.findIndex((function(e){return e._id===a._id})),u=N(N({},a),{},{isComplete:!a.isComplete}),(s=Object(n.a)(t.checklistItems)).splice(c,1,u),m.a.start(),e.next=7,r({userId:t.userId,fieldsToUpdate:{checklistItems:s}});case 7:m.a.done();case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}}),[r])}}}]);